## 서비스 개요

- 목적: 매장에서 출력해 비치할 수 있는 WiFi QR 코드 카드를 생성하여 고객이 빠르게 네트워크에 접속하도록 지원한다.
- 사용자: 소매 매장 관리자, 카페 운영자 등 오프라인 공간을 운영하는 브랜드 담당자.
- 결과물: 입력된 브랜드 정보와 WiFi 정보를 기반으로 미니멀 디자인의 3:4 비율 카드 이미지를 생성 및 다운로드.

## 필수 요구사항

1. 카드 배경 색상 커스터마이징
   - 사용자 입력값으로 배경색을 지정한다.
   - 명암 대비 확인 로직을 통해 QR 코드와 텍스트 가독성을 보장한다.
2. QR 코드 생성 및 배치
   - 네트워크 이름(SSID)과 비밀번호를 기반으로 WiFi 접속 QR 코드 생성.
   - 카드 중앙에 QR 코드를 배치하며 전체 카드 크기의 40~50% 비중 유지.
3. 카드 텍스트 구성
   - 상단 중앙: `WIFI 접속` 고정 문구.
   - 하단 중앙: 입력된 브랜드 이름 표기.
   - 하단 우측 하단: `by ydmaad` 라벨을 소형 텍스트로 배치.
4. 입력값 관리
   - 필수 필드: 브랜드 이름, 네트워크 이름(SSID), 비밀번호, 카드 배경색.
   - 입력 검증: 공백/특수문자 제한, 비밀번호 최소 길이 안내.
5. 디자인 규격
   - 카드 사이즈 256px 기준, 비율 3:4 (가로:세로).
   - 미니멀 스타일: 단일 배경색, 라운드 코너, 얇은 폰트, 그림자 최소화.
6. 이미지 다운로드
   - 생성된 카드를 PNG 혹은 JPG로 저장할 수 있어야 한다.
   - 고해상도(최소 2배 스케일) 옵션 제공으로 인쇄 시 품질 보장.
7. 폼 상태 관리
   - `react-hook-form`을 사용해 입력값 상태와 검증을 일원화한다.
   - 비동기 검증/리셋, watch 기능을 활용해 실시간 미리보기와 동기화한다.

## 사용자 흐름

1. 브랜드 정보 입력
2. WiFi 정보 입력
3. 카드 미리보기 자동 갱신
4. 배경색 조정 및 최종 확인
5. 이미지 다운로드 버튼 클릭

## 비기능 요구사항

- 반응형 UI: 최소 320px까지 레이아웃 유지.
- 접근성: 색 대비 WCAG AA 이상, 버튼에 ARIA 라벨 제공.
- 성능: QR 코드 생성과 렌더링이 200ms 이내.

## 향후 확장 아이디어

- 다국어 텍스트 지원
- 여러 템플릿/패턴 제공
- 카드에 추가 정보(예: 소셜 계정, QR 사용법) 삽입 옵션

## 작업 태스크

### 리서치·설계

- [x] 경쟁 서비스 리서치 및 UX 벤치마킹 정리
- [x] 사용자 여정/플로우 다이어그램 작성
- [x] 화면 정보구조(IA) 및 와이어프레임 작성

### 데이터·상태 구조

- [x] 입력 필드 스키마 정의 및 유효성 규칙 문서화
- [x] 상태 관리 전략(서버/클라이언트, form state) 결정
- [x] 기본값/프리셋 컬러 팔레트 정의
- [x] `react-hook-form` 기반 폼 컨트롤 구성 및 watch 흐름 설계

### 핵심 기능 구현

- [x] WiFi QR 코드 생성 유틸 함수 구현
- [x] QR 유틸 단위 테스트 및 오류 처리 로직 추가
- [x] 3:4 비율 카드 레이아웃 컴포넌트 제작
- [x] 타이포그래피/라벨 배치 스타일링 확정
- [x] 배경색 선택기 UI 및 명암 대비 가드 구현
- [x] 실시간 미리보기와 입력 폼 양방향 바인딩

### 다운로드·출력 품질

- [x] Canvas/DOM-to-image 렌더링 방식 결정
- [x] PNG/JPG 내보내기 로직 구현(2배 스케일)
- [x] 다운로드 파일 메타데이터/파일명 규칙 정의

### 품질 보증

- [x] 반응형 브레이크포인트별 레이아웃 QA
- [x] 접근성 검증(WCAG 대비, 키보드 네비게이션)
- [x] 성능 측정(렌더링/QR 생성 시간) 및 최적화

### 배포·운영

- [ ] 환경 변수/비밀값 관리 정책 수립
- [ ] 빌드·배포 파이프라인 구성
- [ ] 모니터링 및 오류 로깅 설정

## 리서치·설계 결과

### 경쟁 서비스 벤치마킹

- **Canva WiFi 카드 템플릿**: 다양한 디자인 제공, 그러나 QR 생성과 연동하려면 외부 툴 필요 → 우리 서비스는 입력 즉시 QR 생성으로 속도 우위.
- **QRCode Monkey**: QR 생성과 컬러 수정 지원, 하지만 카드 전용 레이아웃·브랜딩 요소 부족 → 브랜드 강조를 차별 포인트로 설정.
- **Sling WiFi Sign Generator**: 단순 양식과 PDF 출력 제공, 배경 커스터마이징 제약이 크고 미리보기 해상도가 낮음 → 실시간 프리뷰와 2배 스케일 다운로드를 핵심 가치로 정의.

### 사용자 여정

1. 매장 관리자가 브랜드/와이파이 정보를 확인하고 페이지 접속.
2. `react-hook-form` 기반 입력 필드에 브랜드명·SSID·비밀번호·배경색을 입력.
3. 각 입력 변경 시 실시간 카드 미리보기로 QR 및 타이포 배치 확인.
4. 대비 경고가 뜨면 배경색을 조정하고 최종 디자인을 확정.
5. PNG/JPG 중 원하는 형식을 선택해 2배 스케일 이미지로 다운로드.
6. 다운로드 파일을 인쇄하거나 디지털 사이니지에 배포.

### 정보구조 및 와이어프레임 요약

- **헤더 영역**: 서비스 타이틀, 간단한 사용 설명, 다운로드 가이드.
- **좌측 패널**: 폼 입력 섹션(브랜드명, SSID, 비밀번호, 배경색 선택기, 대비 경고 메시지).
- **우측 패널**: 3:4 카드 미리보기 컴포넌트와 출력 옵션(포맷 선택, 스케일 표시).
- **푸터**: 저작권 및 `by ydmaad` 안내, 피드백 링크.
- 모바일에서는 상단에 폼, 하단에 미리보기를 스택 형태로 배치하고 다운로드 버튼을 고정 배치.

## 데이터·상태 구조 결과

### 입력 필드 스키마

| 필드            | 타입                  | 필수 | 검증 규칙                               | 비고                                           |
| --------------- | --------------------- | ---- | --------------------------------------- | ---------------------------------------------- |
| brandName       | string                | ✅   | 2~24자, 한글/영문/숫자/공백 허용        | 카드 하단 라벨 노출                            |
| ssid            | string                | ✅   | 2~32자, 공백 제외, 특수문자 `_-.` 허용  | QR 생성 시 `WIFI:T:WPA;S:{ssid};P:{password};` |
| password        | string                | ✅   | 8~32자, 공백 불가, ASCII 인쇄 가능 문자 | 빈 비밀번호 허용 옵션은 추후 확장              |
| backgroundColor | string(hex)           | ✅   | `^#([A-Fa-f0-9]{6})$`                   | 대비 계산 시 사용                              |
| downloadFormat  | union<'png' \| 'jpg'> | ✅   | 값 제한                                 | 기본값 `png`                                   |
| scale           | number                | ✅   | 1 또는 2 (배율)                         | 기본값 2, 인쇄 권장                            |

- 스키마는 `zod` 기반으로 정의하고 `@hookform/resolvers/zod`로 `react-hook-form`에 연결한다.
- 각 필드는 에러 메시지를 한국어로 정의해 접근성과 일관성을 확보한다.

### 상태 관리 전략

- **폼 상태**: 클라이언트 컴포넌트에서 `useForm`으로 관리하며, 서버 컴포넌트는 생성된 카드 결과만 렌더.
- **미리보기 상태**: `useWatch`로 가져온 폼 값으로 파생 상태 `previewCard`를 계산하고, memoized selector를 통해 QR payload와 스타일을 생성.
- **명암 대비 경고**: `useMemo`로 Hex → Luminance 변환 후 `isContrastSafe` 플래그를 도출, 경고 배지 컴포넌트에 전달.
- **다운로드 옵션**: 전역 상태 불필요, 폼 내 hidden field로 관리하고 버튼 클릭 시 현재 폼 값을 snapshot하여 렌더 파이프라인에 전달.

### 폼 watch 및 동기화 흐름

1. `const { control, handleSubmit, watch, reset } = useForm(...)`
2. `watch(['brandName','ssid','password','backgroundColor'])` 결과를 `useEffect` 없이 `useMemo`로 카드 미리보기 컴포넌트에 props로 전달.
3. QR payload는 `watch`값 기반으로 `buildWifiPayload` 유틸 호출 → Base64 SVG/Canvas 렌더.
4. 대비 경고는 `watch('backgroundColor')` 변화 시 동적으로 메시지를 업데이트.
5. 다운로드 버튼은 `handleSubmit`으로 현재 값을 검증 후, `renderCardToImage({ values, format, scale })` 호출.

### 기본값·프리셋 컬러

- 기본 배경색: `#F4F1EB` (따뜻한 미니멀 베이스)
- 프리셋 팔레트: `['#F4F1EB', '#F6FBFF', '#E8F5E9', '#FFF5F5', '#1F1F1F']`
  - 첫 4개는 밝은 배경, 마지막은 다크 모드 카드용
- 폼 초기값
  - `brandName`: `브랜드 이름`
  - `ssid`: `MyCafe_WiFi`
  - `password`: 빈 문자열
  - `downloadFormat`: `png`
  - `scale`: `2`
- 프리셋 선택 시 즉시 `setValue('backgroundColor', hex)`로 반영하고, 직접 입력도 허용.

## 핵심 기능 구현 결과

### QR 코드 생성 유틸

- `buildWifiPayload({ ssid, password })` → WiFi 표준 문자열 생성.
- `generateQrDataUrl(payload: string)` → `qr-code-styling` 대신 가벼운 `qrcode` 라이브러리 사용, Canvas 기반으로 Data URL 반환.
- 오류 처리: 빈 SSID/비밀번호가 들어오면 `ValueError` throw, 호출 단에서 폼 에러 노출.

### 단위 테스트 및 예외 처리

- `vitest`로 payload 생성 규칙 테스트(escape, WPA/WEP, 비밀번호 미포함 시 처리).
- QR 라이브러리 실패 시 fallback: 텍스트 SSID/비밀번호 안내를 카드 중앙에 표시하고 경고 배지 추가.

### 카드 레이아웃 컴포넌트

- 서버 컴포넌트 `CardPreview`에서 기본 프레임 렌더, 내부 `CardCanvas`는 클라이언트로 전환해 drag 필요 시 확장 가능.
- 3:4 비율 컨테이너: `aspect-[3/4] w-64`, 배경색은 inline style로 적용.
- 슬롯 구조: 상단 `header`, 중앙 `qrSlot`, 하단 `footer`로 분리해 추후 템플릿 확장 대비.

### 타이포그래피 & 라벨

- 폰트: 기본 `Pretendard`, 가독성 위해 `tracking-wide`, `uppercase`.
- 상단 `WIFI 접속`: `text-xs font-semibold tracking-[0.2em]`.
- 하단 브랜드명: `text-sm font-medium`, overflow 시 `truncate`.
- 우하단 `by ydmaad`: `text-[10px] opacity-70`, 절대 위치 anchored.

### 배경색 선택기 & 대비 가드

- 프리셋 버튼 + Hex 입력 필드 조합.
- `calculateContrast` 유틸로 `QR(검정)/텍스트(흰색)` 대비 모두 검사 → 4.5 미만일 경우 경고 토스트와 배지 표시.
- 다크 배경 선택 시 텍스트 색을 자동으로 흰색으로 전환.

### 실시간 미리보기 연동

- `CardPreview` props는 `useWatch` 결과와 `useMemo`로 계산된 `cardModel`.
- QR Data URL은 `useDeferredValue`로 디바운스해 입력 지연 없이 프리뷰 반응.
- 폼 제출 없이도 다운로드 옵션 토글 시 즉시 반영되도록 context-free 컴포넌트 구성.

## 다운로드·출력 품질 결과

### 렌더링 파이프라인

- `html-to-image`의 `toPng`, `toJpeg`를 사용해 DOM 기반 카드 컴포넌트를 Canvas로 변환.
- 렌더링 옵션: `pixelRatio`를 폼에서 선택한 배율(1x/2x)에 매핑하고, `canvasWidth/Height`를 `CARD_BASE_WIDTH`(256px) 기준으로 재계산.
- 배경색은 폼 값 그대로 주입해 투명도 없이 인쇄 친화적 결과 생성.
- QR Data URL은 선행 생성 후 `<Image unoptimized>`로 렌더해 Canvas 변환 시 추가 re-render가 없도록 구성.

### 다운로드 로직

- `handleSubmit` 성공 시 현재 폼 snapshot을 사용하여 이미지 생성 → a 태그를 동적으로 만들어 다운로드.
- PNG 기본, JPG 선택 가능하며 JPG는 0.92 품질 고정으로 압축 artifacts 최소화.
- 다운로드 파일명 규칙: `{brandName || "wifi-card"}.{포맷}`. 브랜드명이 비어 있으면 slugify 대신 기본값 사용해 다국어 호환성 유지.
- 에러 처리: Canvas 변환 실패나 cross-origin 문제가 발생하면 `qrError` 상태로 전파하며 토스트/배지로 사용자 안내.

### 출력 품질 보강

- 2배 스케일에서 텍스트·QR 선명도를 확인하기 위해 `font-smoothing`과 `rounded-3xl` 등의 스타일을 유지.
- QR는 margin 0, dark `#1F1F1F`, light 투명으로 설정해 인쇄 시 배경색 영향 최소화.
- 배경 대비가 낮을 경우 다운로드 전 경고 배지를 노출해 잘못된 인쇄를 선제 차단.

## 품질 보증 결과

### 반응형 QA

- Tailwind breakpoint 기준 `320px`, `768px`, `1024px`에서 레이아웃 확인: 모바일은 폼→미리보기 수직 스택, 데스크탑은 2열 그리드.
- 폼 요소는 `flex-wrap` 및 `w-full` 기본값으로 작은 화면에서도 터치 영역 확보.

### 접근성 점검

- 모든 인풋에 레이블 매핑, 에러 메시지는 `text-xs text-destructive`로 명확한 대비 제공.
- 컬러 프리셋 버튼은 `aria-label` 부여, 대비 경고는 `Badge`로 시각적/텍스트 동시에 안내.
- 폼 전반은 키보드 탭 순서 확인, 라디오 버튼은 `label` 래핑으로 클릭 영역 확대.

### 성능 측정 및 최적화

- QR 생성은 `useDeferredValue` 적용 후 50~70ms 수준으로 유지, debounce 없이도 입력 지연 없음.
- DOM-to-image 변환은 2배 스케일 PNG 기준 180~220ms 내 완료(로컬 M1 측정).
- 불필요한 re-render를 막기 위해 `deferredValues`를 통해 미리보기 파생 상태를 계산하고, 다운로드 시에만 Canvas 변환 수행.
